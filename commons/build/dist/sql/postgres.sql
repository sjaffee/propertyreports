CREATE SEQUENCE PERMISSION_BEAN_SEQUENCE START 100;
CREATE TABLE PERMISSION_DB_BEAN (ID BIGINT NOT NULL PRIMARY KEY DEFAULT nextval('PERMISSION_BEAN_SEQUENCE'), ACCESS_TYPE VARCHAR(255), CLASS_TYPE VARCHAR(255) );
ALTER SEQUENCE PERMISSION_BEAN_SEQUENCE OWNED BY PERMISSION_DB_BEAN.ID;

CREATE SEQUENCE ROLE_BEAN_SEQUENCE START 4;
CREATE TABLE ROLE_DB_BEAN (ID BIGINT NOT NULL PRIMARY KEY DEFAULT nextval('ROLE_BEAN_SEQUENCE'), ROLE_NAME VARCHAR(255), TENANT_ID INTEGER NOT NULL);
ALTER SEQUENCE ROLE_BEAN_SEQUENCE OWNED BY ROLE_DB_BEAN.ID;
CREATE INDEX I_ROLE_NAME ON ROLE_DB_BEAN (ROLE_NAME, TENANT_ID);

CREATE TABLE ROLE_PERMISSION_MAP (ROLE_ID INTEGER NOT NULL, PERMISSION_ID INTEGER NOT NULL);
CREATE INDEX I_ROLE_PERMISSION ON ROLE_PERMISSION_MAP (ROLE_ID, PERMISSION_ID);

CREATE SEQUENCE USER_BEAN_SEQUENCE START 2;
CREATE TABLE USER_DB_BEAN (ID BIGINT NOT NULL PRIMARY KEY DEFAULT nextval('USER_BEAN_SEQUENCE'), TENANT_ID INTEGER NOT NULL, PASSWORD BYTEA, USER_NAME VARCHAR(255), PASSWORD_HIST1 BYTEA, PASSWORD_HIST2 BYTEA, PASSWORD_HIST3 BYTEA, PASSWORD_HIST4 BYTEA, PASSWORD_HIST5 BYTEA, PASSWORD_HIST6 BYTEA, PASSWORD_HIST7 BYTEA, FORCE_RESET BOOLEAN, PASSWORD_SET_DATE DATE, LOGIN_ATTEMPTS INTEGER, UNLOCK_DATE TIMESTAMP);
ALTER SEQUENCE USER_BEAN_SEQUENCE OWNED BY USER_DB_BEAN.ID;
CREATE INDEX I_USER_NAME ON USER_DB_BEAN (USER_NAME);

CREATE TABLE USER_ROLE_MAP (USER_ID INTEGER NOT NULL, ROLE_ID INTEGER NOT NULL);
CREATE INDEX I_USER_ROLE ON USER_ROLE_MAP (USER_ID, ROLE_ID);

CREATE TABLE OBJECT_LOCK_BEAN (ID INTEGER NOT NULL, TENANT_ID INTEGER NOT NULL, CLASS_NAME VARCHAR(255) NOT NULL, LOCK_TIME TIMESTAMP, USER_NAME VARCHAR(255), APPLICATION_NAME VARCHAR(255), HOST_NAME VARCHAR(255), PRIMARY KEY(ID, CLASS_NAME));

CREATE TABLE SYSTEM_PROPERTY (PROPERTY_NAME VARCHAR(255) NOT NULL, PROPERTY_VALUE VARCHAR(255), TENANT_ID INTEGER NOT NULL, PRIMARY KEY(PROPERTY_NAME, TENANT_ID));

CREATE SEQUENCE CONFIGURED_ITEM_SEQUENCE START 100;
CREATE TABLE CONFIGURED_ITEM (IDX BIGINT NOT NULL PRIMARY KEY DEFAULT nextval('CONFIGURED_ITEM_SEQUENCE'), TENANT_ID INTEGER NOT NULL, UUID_MSB NUMERIC(19,0) NOT NULL, UUID_LSB NUMERIC(19,0) NOT NULL, ITEM_NAME VARCHAR(255), TYPE_NAME VARCHAR(255), XML TEXT);
ALTER SEQUENCE CONFIGURED_ITEM_SEQUENCE OWNED BY CONFIGURED_ITEM.IDX;
CREATE INDEX I_CONFIGURED_ITEM_UUID ON CONFIGURED_ITEM (UUID_MSB, UUID_LSB, TENANT_ID);
CREATE INDEX I_CONFIGURED_ITEM_NAME ON CONFIGURED_ITEM (ITEM_NAME, TENANT_ID);
CREATE INDEX I_CONFIGURED_ITEM_TYPE ON CONFIGURED_ITEM (TYPE_NAME, TENANT_ID);

CREATE TABLE RESOURCE_ROLE_MAP (ROLE_ID INTEGER NOT NULL, RESOURCE_KEY VARCHAR(255) NOT NULL, TENANT_ID INTEGER NOT NULL);
CREATE INDEX I_RESOURCE_ROLE ON RESOURCE_ROLE_MAP (RESOURCE_KEY, TENANT_ID);

CREATE SEQUENCE TENANT_SEQUENCE START WITH 2;
CREATE TABLE TENANT (ID BIGINT NOT NULL PRIMARY KEY DEFAULT nextval('TENANT_SEQUENCE'), NAME VARCHAR(255) NOT NULL, DESCRIPTION VARCHAR(255), IS_DEFAULT BOOLEAN DEFAULT FALSE NOT NULL CHECK (IS_DEFAULT IN (FALSE, TRUE)));
ALTER SEQUENCE TENANT_SEQUENCE OWNED BY TENANT.ID;
CREATE INDEX I_TENANT_NAME ON TENANT (NAME);

INSERT INTO TENANT VALUES (1, 'System', 'Default System tenant', TRUE);

INSERT INTO SYSTEM_PROPERTY VALUES ('SECURITY_PASSWORD_EXPIRE_DAYS', '30', 1);
INSERT INTO SYSTEM_PROPERTY VALUES ('SECURITY_PASSWORD_HISTORY', '3', 1);
INSERT INTO SYSTEM_PROPERTY VALUES ('PASSWORD_UPPER_REQUIRED_PROPERTY', 'true', 1);
INSERT INTO SYSTEM_PROPERTY VALUES ('PASSWORD_LOWER_REQUIRED_PROPERTY', 'true', 1);
INSERT INTO SYSTEM_PROPERTY VALUES ('PASSWORD_NUMERIC_REQUIRED_PROPERTY', 'true', 1);
INSERT INTO SYSTEM_PROPERTY VALUES ('PASSWORD_SYMBOL_REQUIRED_PROPERTY', 'true', 1);
INSERT INTO SYSTEM_PROPERTY VALUES ('PASSWORD_REQUIRED_COUNT_PROPERTY', '3', 1);
INSERT INTO SYSTEM_PROPERTY VALUES ('PASSWORD_MAXIMUM_LENGTH_PROPERTY', '20', 1);
INSERT INTO SYSTEM_PROPERTY VALUES ('PASSWORD_MINIMUM_LENGTH_PROPERTY', '8', 1);
INSERT INTO SYSTEM_PROPERTY VALUES ('PASSWORD_MAXIMUM_LOGIN_ATTEMPTS_PROPERTY', '5', 1);
INSERT INTO SYSTEM_PROPERTY VALUES ('PASSWORD_LOCKOUT_MINUTES_PROPERTY', '15', 1);

INSERT INTO USER_DB_BEAN (ID, USER_NAME, FORCE_RESET, TENANT_ID) VALUES (1, 'admin', FALSE, 1);

INSERT INTO PERMISSION_DB_BEAN VALUES (1, 'r', 'com.ali.commons.security.UserBean');
INSERT INTO PERMISSION_DB_BEAN VALUES (2, 'w', 'com.ali.commons.security.UserBean');
INSERT INTO PERMISSION_DB_BEAN VALUES (3, 'c', 'com.ali.commons.security.UserBean');
INSERT INTO PERMISSION_DB_BEAN VALUES (4, 'd', 'com.ali.commons.security.UserBean');
INSERT INTO PERMISSION_DB_BEAN VALUES (5, 'r', 'com.ali.commons.security.RoleBean');
INSERT INTO PERMISSION_DB_BEAN VALUES (6, 'w', 'com.ali.commons.security.RoleBean');
INSERT INTO PERMISSION_DB_BEAN VALUES (7, 'c', 'com.ali.commons.security.RoleBean');
INSERT INTO PERMISSION_DB_BEAN VALUES (8, 'd', 'com.ali.commons.security.RoleBean');
INSERT INTO PERMISSION_DB_BEAN VALUES (9, 'r', 'com.ali.commons.security.RootSecurityManager');
INSERT INTO PERMISSION_DB_BEAN VALUES (10, 'w', 'com.ali.commons.security.RootSecurityManager');
INSERT INTO PERMISSION_DB_BEAN VALUES (11, 'r', 'com.ali.commons.security.ResourceRoleBean');
INSERT INTO PERMISSION_DB_BEAN VALUES (12, 'w', 'com.ali.commons.security.ResourceRoleBean');
INSERT INTO PERMISSION_DB_BEAN VALUES (13, 'r', 'com.ali.commons.security.TenantBean');
INSERT INTO PERMISSION_DB_BEAN VALUES (14, 'w', 'com.ali.commons.security.TenantBean');
INSERT INTO PERMISSION_DB_BEAN VALUES (15, 'c', 'com.ali.commons.security.TenantBean');
INSERT INTO PERMISSION_DB_BEAN VALUES (16, 'd', 'com.ali.commons.security.TenantBean');

INSERT INTO ROLE_DB_BEAN VALUES (1, 'Administrator', 1);
INSERT INTO ROLE_DB_BEAN VALUES (2, 'View Only', 1);
INSERT INTO ROLE_DB_BEAN VALUES (3, 'User Administrator', 1);

INSERT INTO USER_ROLE_MAP VALUES (1, 1);
INSERT INTO USER_ROLE_MAP VALUES (1, 2);

INSERT INTO ROLE_PERMISSION_MAP VALUES (1, 1);
INSERT INTO ROLE_PERMISSION_MAP VALUES (1, 2);
INSERT INTO ROLE_PERMISSION_MAP VALUES (1, 3);
INSERT INTO ROLE_PERMISSION_MAP VALUES (1, 4);
INSERT INTO ROLE_PERMISSION_MAP VALUES (1, 5);
INSERT INTO ROLE_PERMISSION_MAP VALUES (1, 6);
INSERT INTO ROLE_PERMISSION_MAP VALUES (1, 7);
INSERT INTO ROLE_PERMISSION_MAP VALUES (1, 8);
INSERT INTO ROLE_PERMISSION_MAP VALUES (1, 9);
INSERT INTO ROLE_PERMISSION_MAP VALUES (1, 10);
INSERT INTO ROLE_PERMISSION_MAP VALUES (1, 11);
INSERT INTO ROLE_PERMISSION_MAP VALUES (1, 12);

INSERT INTO ROLE_PERMISSION_MAP VALUES (2, 1);
INSERT INTO ROLE_PERMISSION_MAP VALUES (2, 5);
INSERT INTO ROLE_PERMISSION_MAP VALUES (2, 9);
INSERT INTO ROLE_PERMISSION_MAP VALUES (2, 11);

INSERT INTO ROLE_PERMISSION_MAP VALUES (3, 1);
INSERT INTO ROLE_PERMISSION_MAP VALUES (3, 2);
INSERT INTO ROLE_PERMISSION_MAP VALUES (3, 3);
INSERT INTO ROLE_PERMISSION_MAP VALUES (3, 4);
INSERT INTO ROLE_PERMISSION_MAP VALUES (3, 5);
INSERT INTO ROLE_PERMISSION_MAP VALUES (3, 6);
INSERT INTO ROLE_PERMISSION_MAP VALUES (3, 7);
INSERT INTO ROLE_PERMISSION_MAP VALUES (3, 8);
INSERT INTO ROLE_PERMISSION_MAP VALUES (3, 9);
INSERT INTO ROLE_PERMISSION_MAP VALUES (3, 10);
INSERT INTO ROLE_PERMISSION_MAP VALUES (3, 11);
INSERT INTO ROLE_PERMISSION_MAP VALUES (3, 12);

ALTER TABLE user_db_bean ADD user_admin BOOLEAN DEFAULT FALSE NOT NULL;
INSERT INTO USER_DB_BEAN (ID,USER_NAME,FORCE_RESET, TENANT_ID,USER_ADMIN) VALUES (nextval('USER_BEAN_SEQUENCE'), 'useradmin', FALSE, 1,TRUE);
INSERT INTO USER_ROLE_MAP VALUES (currval('USER_BEAN_SEQUENCE'), 3);

ALTER TABLE USER_DB_BEAN ADD LAST_LOGIN_DATE DATE NOT NULL DEFAULT NOW();

-- insert the new useradmin view only role
INSERT INTO ROLE_DB_BEAN VALUES (nextval('ROLE_BEAN_SEQUENCE'), 'User Administrator View Only', 1);

-- insert the new useradmin view only role permissions
INSERT INTO ROLE_PERMISSION_MAP (ROLE_ID, PERMISSION_ID) 
SELECT currval('ROLE_BEAN_SEQUENCE'), PERMISSION_ID FROM ROLE_PERMISSION_MAP WHERE ROLE_ID=2;

CREATE SEQUENCE NOBLE_LCH_SEQ START 100;
CREATE TABLE NOBLE_LCH ( ID BIGINT NOT NULL PRIMARY KEY DEFAULT nextval('NOBLE_LCH_SEQ'), CREATE_DATE TIMESTAMP NOT NULL, "COUNT" BYTEA NOT NULL, "DATE" BYTEA NOT NULL, "HOUR" BYTEA NOT NULL);
ALTER SEQUENCE NOBLE_LCH_SEQ OWNED BY NOBLE_LCH.ID;

CREATE SEQUENCE NOBLE_L_SEQ START 100;
CREATE TABLE NOBLE_L (ID BIGINT NOT NULL PRIMARY KEY DEFAULT nextval('NOBLE_L_SEQ'), LCOUNT BYTEA NOT NULL, EXPIRY_DATE BYTEA NOT NULL, LASTCHECKED BYTEA, WARN_PCNT_USED BYTEA NOT NULL, WARN_DAYS_PRIOR_EXPY BYTEA NOT NULL, DAYS_WARN_MCU BYTEA NOT NULL, USER_COUNT BYTEA, USER_DATE BYTEA, USER_HOUR BYTEA, IS_EXPIRED BYTEA, IS_EXCEEDED BYTEA, EXCEEDED_DATE BYTEA);
ALTER SEQUENCE NOBLE_L_SEQ OWNED BY NOBLE_L.ID;
